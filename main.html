<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>(주)동특 | 로그인</title>
  <style>
    :root {
      --ink: #0e1a2b;
      --deep: #14233b;
      --accent: #0b5fc1;
      --accent-2: #5aa7e6;
      --paper: #f7f2e8;
      --mist: rgba(255, 255, 255, 0.65);
      --shadow: 0 30px 80px rgba(10, 18, 30, 0.25);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Malgun Gothic", "맑은 고딕", "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(900px 360px at 12% 0%, rgba(0, 94, 184, 0.08), transparent 65%),
        radial-gradient(800px 360px at 90% 10%, rgba(11, 95, 193, 0.08), transparent 60%),
        linear-gradient(180deg, #fbfbfd 0%, #f3f5f8 55%, #eef1f5 100%);
      display: grid;
      place-items: center;
      padding: 32px 20px 40px;
      position: relative;
    }

    .shell {
      width: min(980px, 100%);
      display: grid;
      grid-template-columns: minmax(260px, 1fr) minmax(320px, 1fr);
      gap: 32px;
      align-items: stretch;
      margin-top: 70px;
    }

    .brand {
      background: rgba(20, 35, 59, 0.95);
      color: #fdf9f1;
      padding: 40px;
      border-radius: 26px;
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .brand::before {
      content: "";
      position: absolute;
      width: 360px;
      height: 360px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(11, 95, 193, 0.5), rgba(11, 95, 193, 0) 70%);
      top: -140px;
      right: -120px;
    }

    .brand::after {
      content: "";
      position: absolute;
      width: 240px;
      height: 240px;
      border-radius: 20% 60% 40% 60%;
      background: rgba(90, 167, 230, 0.35);
      bottom: -120px;
      left: -90px;
      filter: blur(4px);
    }

    .brand h1 {
      margin: 0 0 10px;
      font-size: clamp(28px, 3vw, 40px);
      letter-spacing: 0.04em;
    }

    .brand p {
      margin: 0 0 24px;
      font-size: 15px;
      line-height: 1.7;
      color: rgba(253, 249, 241, 0.8);
    }

    .brand     .badge span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--accent);
      display: inline-block;
    }

    .page-header {
      position: absolute;
      top: 20px;
      left: 20px;
      display: inline-flex;
      align-items: center;
      gap: 12px;
      padding: 10px 14px;
      background: #ffffff;
      border-radius: 14px;
      box-shadow: 0 16px 30px rgba(15, 23, 42, 0.12);
      border: 1px solid rgba(15, 23, 42, 0.06);
    }

    .page-logo {
      width: 160px;
      height: auto;
      display: block;
    }

    .login {
      background: var(--mist);
      backdrop-filter: blur(16px);
      border-radius: 26px;
      padding: 36px 34px 32px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.5);
      display: flex;
      flex-direction: column;
      justify-content: center;
      animation: float-in 600ms ease-out;
    }

    .login h2 {
      margin: 0 0 8px;
      font-size: 24px;
    }

    .login p {
      margin: 0 0 28px;
      font-size: 14px;
      color: rgba(14, 26, 43, 0.7);
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 18px;
    }

    label {
      font-size: 13px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: rgba(14, 26, 43, 0.7);
    }

    input {
      height: 46px;
      border-radius: 12px;
      border: 1px solid rgba(14, 26, 43, 0.15);
      padding: 0 14px;
      font-size: 15px;
      background: rgba(255, 255, 255, 0.9);
      transition: border 200ms ease, box-shadow 200ms ease;
    }

    input:focus {
      outline: none;
      border-color: rgba(11, 95, 193, 0.5);
      box-shadow: 0 0 0 3px rgba(11, 95, 193, 0.2);
    }

    .actions {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 4px;
      gap: 16px;
    }

    .remember-row {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      margin: 4px 0;
    }

    .remember-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      text-transform: none;
      color: rgba(14, 26, 43, 0.7);
    }

    .remember-item input {
      margin: 0;
    }

    .actions a {
      font-size: 13px;
      color: var(--deep);
      text-decoration: none;
      border-bottom: 1px solid rgba(14, 26, 43, 0.3);
    }

    .login button {
      height: 48px;
      border-radius: 999px;
      border: none;
      padding: 0 26px;
      background: linear-gradient(135deg, var(--accent) 0%, #6fb2f0 100%);
      color: #22170b;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      box-shadow: 0 10px 24px rgba(11, 95, 193, 0.3);
      transition: transform 150ms ease, box-shadow 150ms ease;
    }

    .login button:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 28px rgba(11, 95, 193, 0.4);
    }

    .meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 24px;
      font-size: 12px;
      color: rgba(14, 26, 43, 0.55);
    }

    .meta span {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .meta span::before {
      content: "";
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent-2);
    }

    .form-error {
      margin-top: 14px;
      padding: 10px 12px;
      border-radius: 10px;
      background: rgba(239, 65, 54, 0.12);
      color: #8b1d16;
      font-size: 13px;
    }
    @keyframes float-in {
      from {
        opacity: 0;
        transform: translateY(14px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 860px) {
      .shell {
        grid-template-columns: 1fr;
        margin-top: 0;
      }

      .brand {
        padding: 32px;
      }

      .login {
        padding: 30px 26px;
      }

      .page-header {
        position: static;
        margin-bottom: 18px;
        justify-self: start;
      }
    }
    /* Pebble header */
    .page-header {
      background: #ffffff;
      color: var(--ink);
      padding: 16px 22px;
      border-radius: 999px;
      box-shadow: 0 12px 24px rgba(11, 95, 193, 0.18);
      border: 1px solid rgba(15, 23, 42, 0.08);
    }

    .page-header h1 {
      color: var(--ink);
    }
  
    /* Mobile layout */
    @media (max-width: 720px) {
      .layout {
        grid-template-columns: 1fr;
      }

      .sidebar {
        width: 100%;
        height: auto;
        position: static;
        flex-direction: row;
        align-items: center;
        gap: 8px;
        overflow-x: hidden;
        padding: 10px;
        flex-wrap: wrap;
      }

      .sidebar-footer {
        display: none;
      }

      .logo {
        width: 80px;
        margin: 0 8px 0 0;
      }

      .menu {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .menu a {
        white-space: nowrap;
        font-size: 12px;
        height: 32px;
      }

      .main {
        padding: 18px 14px 28px;
      }

      .table-wrap {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .card {
        border-radius: 16px;
        padding: 14px;
      }

      .page-header,
      .topbar {
        flex-wrap: wrap;
        gap: 10px;
        height: auto;
        min-height: 0;
      }
    }
  </style>
</head>
<body>
  <header class="page-header" aria-label="회사 로고">
    <img class="page-logo" src="Dongteuk.png" alt="(주)동특 로고" />
  </header>
  <main class="shell">
    <section class="brand">
      <div class="badge"><span></span> Dongteuk Portal</div>
      <h1>(주)동특 천안터미널</h1>
      <p>
        1977년 설립 이래로 지속적인 성장을 거듭하여 현재 최첨단종합물류회사로 발전해 왔으며
        선진화된 국제물류업무(International FreightForwarder)의 도입으로 좀더 친숙한 회사,
        고객이 감동할 수 있게 고객의 욕구를 먼저 생각하는 회사가 되고자 합니다.
      </p>
      <p>
        동특 천안터미널 포털 접근은 승인이 필요합니다.
      </p>
    </section>

    <section class="login" aria-label="로그인">
      <h2>포털 로그인</h2>
      <p>회사 계정으로 안전하게 접속하세요.</p>

      <form id="login-form" action="/login" method="post">
        <div class="field">
          <label for="user-id">아이디</label>
          <input id="user-id" name="username" type="text" placeholder="아이디를 입력하세요" autocomplete="username" required />
        </div>
        <div class="field">
          <label for="user-pass">비밀번호</label>
          <input id="user-pass" name="password" type="password" placeholder="비밀번호를 입력하세요" autocomplete="current-password" required />
        </div>
        <div class="remember-row">
          <label class="remember-item">
            <input type="checkbox" id="remember-id" />
            아이디 저장
          </label>
          <label class="remember-item">
            <input type="checkbox" id="remember-pass" />
            비밀번호 저장
          </label>
          <label class="remember-item">
            <input type="checkbox" id="auto-login" />
            자동 로그인
          </label>
        </div>
        <div class="actions">
          <a href="#" onclick="alert('관리자에게 문의하세요.'); return false;">비밀번호 재설정</a>
          <button type="submit">로그인</button>
        </div>
        <div class="form-error" id="login-error" role="alert" aria-live="polite" hidden>
          관리자에게 문의하세요.
        </div>
      </form>

      <div class="meta">
        <span>보안 접속 중</span>
        <div>ⓒ DONGTEUK CO., LTD.</div>
      </div>
    </section>
  </main>
  <script>
    const form = document.getElementById("login-form");
    const error = document.getElementById("login-error");
    const rememberId = document.getElementById("remember-id");
    const rememberPass = document.getElementById("remember-pass");
    const autoLogin = document.getElementById("auto-login");
    const usernameInput = document.getElementById("user-id");
    const passwordInput = document.getElementById("user-pass");
    const storageKeys = {
      id: "dongteukRememberId",
      pass: "dongteukRememberPass",
      auto: "dongteukAutoLogin",
      savedId: "dongteukSavedId",
      savedPass: "dongteukSavedPass"
    };
    const seedDrivers = [
      { name: "강현구", title: "책임", dongteukId: "15085", apkId: "997254", phone: "010 6415 6978", mobile: "010 5910 7039", status: "근무" },
      { name: "곽호곤", title: "책임/파트장", dongteukId: "16059", apkId: "997256", phone: "010 8858 8585", mobile: "010 5920 9165", status: "근무" },
      { name: "김광한", title: "책임", dongteukId: "19049", apkId: "812150", phone: "010 9444 1235", mobile: "010 5920 5527", status: "근무" },
      { name: "김교돈", title: "책임", dongteukId: "22002", apkId: "997257", phone: "010 3546 3781", mobile: "010 5910 4344", status: "근무" },
      { name: "김영식", title: "책임/파트장", dongteukId: "15072", apkId: "997258", phone: "010 9403 7569", mobile: "010 5920 4041", status: "근무" },
      { name: "김원제", title: "책임", dongteukId: "16011", apkId: "997260", phone: "010 8962 3485", mobile: "010 5910 9178", status: "근무" },
      { name: "김종식", title: "책임", dongteukId: "19041", apkId: "997261", phone: "010 3669 7590", mobile: "010 5920 9341", status: "근무" },
      { name: "김필곤", title: "책임", dongteukId: "17039", apkId: "997499", phone: "010 3512 8954", mobile: "010 5910 6476", status: "근무" },
      { name: "김효철", title: "기사", dongteukId: "21024", apkId: "816608", phone: "010 5233 8034", mobile: "010 5910 3154", status: "근무" },
      { name: "나강일", title: "책임", dongteukId: "24034", apkId: "997252", phone: "010 5283 0417", mobile: "010 5910 8541", status: "근무" },
      { name: "신동영", title: "책임", dongteukId: "17026", apkId: "997281", phone: "010 8811 3368", mobile: "010 5920 1373", status: "근무" },
      { name: "유성열", title: "선임", dongteukId: "19025", apkId: "811121", phone: "010 6227 7758", mobile: "010 5298 7887", status: "근무" },
      { name: "윤두호", title: "선임", dongteukId: "21027", apkId: "817046", phone: "010-7537-0436", mobile: "010 5920 9513", status: "근무" },
      { name: "이경민", title: "책임/파트장", dongteukId: "15080", apkId: "976073", phone: "010 9026 0220", mobile: "010 5920 9516", status: "근무" },
      { name: "이대엽", title: "책임/파트장", dongteukId: "16070", apkId: "997273", phone: "010 3558 4614", mobile: "010 5920 2059", status: "근무" },
      { name: "이석봉", title: "책임", dongteukId: "18032", apkId: "998756", phone: "010 4443 0561", mobile: "010 5920 8094", status: "근무" },
      { name: "이주영", title: "기사", dongteukId: "22010", apkId: "817676", phone: "010 5427 4695", mobile: "010 5920 8077", status: "근무" },
      { name: "주찬우", title: "기사", dongteukId: "24019", apkId: "821646", phone: "010 7751 4180", mobile: "010 5920 8413", status: "근무" },
      { name: "한심록", title: "기사", dongteukId: "22018", apkId: "818187", phone: "010 9501 1235", mobile: "010 5920 8550", status: "근무" },
      { name: "현태수", title: "기사", dongteukId: "21021", apkId: "815961", phone: "010 8367 2281", mobile: "010 5920 8269", status: "근무" },
      { name: "홍승표", title: "선임", dongteukId: "19030", apkId: "811117", phone: "010 9149 4800", mobile: "010 5920 9271", status: "근무" },
      { name: "김민찬", title: "기사", dongteukId: "25008", apkId: "", phone: "010 7420 6323", mobile: "", status: "근무" },
      { name: "조성표", title: "기사", dongteukId: "25009", apkId: "", phone: "010 8104 3390", mobile: "", status: "근무" },
      { name: "김근영", title: "기사", dongteukId: "25013", apkId: "", phone: "010 7548 0404", mobile: "", status: "근무" },
      { name: "정재호", title: "기사", dongteukId: "25012", apkId: "", phone: "010 8184 0169", mobile: "", status: "근무" },
      { name: "심성민", title: "부장", dongteukId: "19009", apkId: "810532", phone: "010 7404 0029", mobile: "", status: "관리자" },
      { name: "유미", title: "차장", dongteukId: "16079", apkId: "969832", phone: "010 5416 4566", mobile: "", status: "관리자" },
      { name: "강윤아", title: "과장", dongteukId: "17036", apkId: "125561", phone: "010 8817 2475", mobile: "", status: "관리자" },
      { name: "류성희", title: "차장", dongteukId: "15068", apkId: "997263", phone: "010 5456 9726", mobile: "안전관리자", status: "관리자" },
      { name: "관리자", title: "관리자", dongteukId: "00000", apkId: "", phone: "", mobile: "", status: "관리자" }
    ];
    const adminNames = new Set(["관리자", "심성민", "유미", "강윤아", "류성희"]);
    const seedDriverData = () => {
      try {
        const existing = JSON.parse(localStorage.getItem("dongteukDrivers") || "[]");
        if (Array.isArray(existing) && existing.length) return;
      } catch (error) {
      }
      localStorage.setItem("dongteukDrivers", JSON.stringify(seedDrivers));
    };

    const normalizeDigits = (value) => (value || "").replace(/\D/g, "");
    const getLastFour = (value) => normalizeDigits(value).slice(-4);

    seedDriverData();
    const loadLoginPrefs = () => {
      if (!rememberId || !rememberPass || !autoLogin) return;
      rememberId.checked = localStorage.getItem(storageKeys.id) === "1";
      rememberPass.checked = localStorage.getItem(storageKeys.pass) === "1";
      autoLogin.checked = localStorage.getItem(storageKeys.auto) === "1";
      if (rememberId.checked && usernameInput) {
        usernameInput.value = localStorage.getItem(storageKeys.savedId) || "";
      }
      if (rememberPass.checked && passwordInput) {
        passwordInput.value = localStorage.getItem(storageKeys.savedPass) || "";
      }
    };

    const saveLoginPrefs = () => {
      if (!rememberId || !rememberPass || !autoLogin) return;
      localStorage.setItem(storageKeys.id, rememberId.checked ? "1" : "0");
      localStorage.setItem(storageKeys.pass, rememberPass.checked ? "1" : "0");
      localStorage.setItem(storageKeys.auto, autoLogin.checked ? "1" : "0");
      if (rememberId.checked && usernameInput) {
        localStorage.setItem(storageKeys.savedId, usernameInput.value.trim());
      } else {
        localStorage.removeItem(storageKeys.savedId);
      }
      if (rememberPass.checked && passwordInput) {
        localStorage.setItem(storageKeys.savedPass, passwordInput.value);
      } else {
        localStorage.removeItem(storageKeys.savedPass);
      }
    };

    if (rememberId) {
      rememberId.addEventListener("change", saveLoginPrefs);
    }
    if (rememberPass) {
      rememberPass.addEventListener("change", () => {
        if (!rememberPass.checked && autoLogin) {
          autoLogin.checked = false;
        }
        saveLoginPrefs();
      });
    }
    if (autoLogin) {
      autoLogin.addEventListener("change", () => {
        if (autoLogin.checked && rememberPass && !rememberPass.checked) {
          rememberPass.checked = true;
        }
        saveLoginPrefs();
      });
    }

    loadLoginPrefs();

    const tryApiLogin = async (username, password) => {
      try {
        const response = await fetch("/api/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password })
        });
        if (response.status === 404 || response.status >= 500) {
          return { available: false };
        }
        const data = await response.json().catch(() => ({}));
        return { available: true, ok: response.ok && data.ok, user: data.user };
      } catch (err) {
        return { available: false };
      }
    };

    form.addEventListener("submit", async (event) => {
      event.preventDefault();
      if (!form.checkValidity()) {
        error.hidden = false;
        error.textContent = "관리자에게 문의하세요.";
        return;
      }
      const username = (usernameInput?.value || "").trim();
      const password = (passwordInput?.value || "").trim();
      const apiResult = await tryApiLogin(username, password);
      if (apiResult.available) {
        if (apiResult.ok) {
          error.hidden = true;
          localStorage.setItem("dongteukCurrentUser", username);
          if (apiResult.user?.role) {
            localStorage.setItem("dongteukCurrentRole", apiResult.user.role);
          }
          localStorage.setItem("dongteukLoginTime", new Date().toISOString());
          saveLoginPrefs();
          const firstKey = `dongteukFirstLogin:${username}`;
          if (!localStorage.getItem(firstKey)) {
            localStorage.setItem(firstKey, "1");
            alert("최초 로그인입니다. 비밀번호를 변경해 주세요.");
            window.location.href = "settings.html";
            return;
          }
          window.location.href = "second.html";
          return;
        }
        error.hidden = false;
        error.textContent = "관리자에게 문의하세요.";
        return;
      }

      let drivers = [];
      let passwords = {};
      try {
        drivers = JSON.parse(localStorage.getItem("dongteukDrivers") || "[]");
      } catch (e) {
        drivers = [];
      }
      try {
        passwords = JSON.parse(localStorage.getItem("dongteukPasswords") || "{}");
      } catch (e) {
        passwords = {};
      }
      const storedMatch = drivers.find((driver) => (driver.name || "").trim() === username) || null;
      const seedMatch = seedDrivers.find((driver) => (driver.name || "").trim() === username) || null;
      const stored = passwords[username];
      const ok = stored ? password === stored : password === "0000";
      const adminOverride = adminNames.has(username) && password === "0000";
      if (!storedMatch && seedMatch && ok) {
        const merged = drivers.slice();
        const existingKeys = new Set(merged.map((item) => item.dongteukId || item.apkId || item.name));
        const key = seedMatch.dongteukId || seedMatch.apkId || seedMatch.name;
        if (!existingKeys.has(key)) {
          merged.push(seedMatch);
          localStorage.setItem("dongteukDrivers", JSON.stringify(merged));
        }
      }
      if ((storedMatch || seedMatch) && (ok || adminOverride)) {
        error.hidden = true;
        localStorage.setItem("dongteukCurrentUser", username);
        localStorage.setItem("dongteukLoginTime", new Date().toISOString());
        saveLoginPrefs();
        const firstKey = `dongteukFirstLogin:${username}`;
        if (!localStorage.getItem(firstKey)) {
          localStorage.setItem(firstKey, "1");
          alert("최초 로그인입니다. 비밀번호를 변경해 주세요.");
          window.location.href = "settings.html";
          return;
        }
        window.location.href = "second.html";
        return;
      }
      error.hidden = false;
      error.textContent = "관리자에게 문의하세요.";
    });

    if (autoLogin && autoLogin.checked) {
      if (usernameInput?.value && passwordInput?.value) {
        if (form.requestSubmit) {
          form.requestSubmit();
        } else {
          form.dispatchEvent(new Event("submit", { cancelable: true, bubbles: true }));
        }
      }
    }
  </script>
</body>
</html>





















